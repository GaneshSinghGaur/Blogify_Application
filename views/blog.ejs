<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>Blog</title>
  </head>
  <body>
    <%- include('./partials/nav.ejs') %>
    <div class="container mt-4">
      <h1><%= blog.title %></h1>
      <img src="<%= blog.coverImageURL %>" width="500px" />
      <pre><%= blog.body %></pre>
    </div>

    <div class="container mt-4">
      <img src="<%= blog.createdBy.profileImageURL %>" width="50px" /><%=
      blog.createdBy.fullName %>
    </div>

    <div class="container mt-3">
      <h1>Comments (<%= comments.length %>)</h1>

      <% if (locals.user) { %> <% if (error === 'empty') { %>
      <div id="alertBox" class="alert alert-danger" role="alert">
        Comment cannot be empty!
      </div>
      <% } %>

      <form action="/blog/comment/<%= blog._id %>" method="post">
        <div class="mb-3">
          <input
            type="text"
            name="content"
            id="commentInput"
            class="form-control"
            placeholder="Enter Your Comment"
            oninput="toggleButton()"
          />
          <button
            id="submitBtn"
            type="submit"
            class="btn btn-sm btn-primary mt-2"
            disabled
          >
            Add
          </button>
        </div>
      </form>
      <% } %>

      <div class="mt-3">
        <% comments.forEach(comment => { %>
        <img src="<%= comment.createdBy.profileImageURL %>" width="50px" />
        <%= comment.createdBy.fullName %>
        <pre><%= comment.content %></pre>
        <% }) %>
      </div>
    </div>
  </body>
</html>
<!-- ✅ Place the script AFTER the HTML -->
<script>
  // Disable button if comment empty
  const input = document.getElementById("commentInput");
  const submitBtn = document.getElementById("submitBtn");
  function toggleButton() {
    submitBtn.disabled = input.value.trim().length === 0;
  }

  // ✅ Remove ?error=empty from URL after showing alert once
  const alertBox = document.getElementById("alertBox");
  if (alertBox) {
    const url = new URL(window.location.href);
    url.searchParams.delete("error");
    window.history.replaceState({}, document.title, url.pathname);
  }
</script>
